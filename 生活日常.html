<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  生活日常 - 博客未命名
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="博客未命名" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:lixindong.top ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; 博客未命名</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
       
       <li><a href="index.html">HOME</a></li>
    <li><a href="archives.html">Archives</a></li>
    <li><a href="about.html">ABOUT</a></li>

    <li><label>Categories</label></li>

        
            <li><a href="%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8.html">生活日常</a></li>
        
            <li><a href="%E7%BB%98%E7%94%BB.html">绘画</a></li>
        
            <li><a href="Android%E5%BC%80%E5%8F%91.html">Android开发</a></li>
        
            <li><a href="%E4%BA%A7%E5%93%81%E6%83%B3%E6%B3%95.html">产品想法</a></li>
        
            <li><a href="%E5%90%89%E5%AE%83%E5%AD%A6%E4%B9%A0%F0%9F%8E%B8.html">吉它学习🎸</a></li>
        
            <li><a href="web%E5%BC%80%E5%8F%91.html">web开发</a></li>
        
            <li><a href="%E4%B9%A6%E7%B1%8D%E7%94%B5%E5%BD%B1.html">书籍电影</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="14805196774412.html">
                
                  <h1>生而为人，总要经历送礼这回事。逢年过节倒还好，亲戚朋友送些吃的喝的也就过去了。可是平时见朋友，过生日之类，选择什么礼物就成了一大烦恼。</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>有人说，送礼重要的是情谊，无论礼物轻重贵贱，只要真心祝福，朋友自然会开心。<br/>
道理是这样，我也在一定程度上表示认同。所以我今天要讲的不是价格高低，也不是品类含义，而只是讲讲我在选择礼物时的思考。</p>

<h2 id="toc_0">消耗品 or 非消耗品</h2>

<p>在北京租房经历过几次搬家，加之对山下英子老师断舍离思想的认同，让我形成了「如果不是必要的，就不要随意添加」的观念。以至于每每要准备礼物，我都要消瘦三斤。<br/>
因为万一选取不当，便会成为被赠与者的负担。<br/>
“丢弃过意不去，放在家里不合适，礼物本身不适合转送，干脆建个专门收藏礼物的收藏馆吧”。于是新的创业项目风火出炉。<br/>
因此若非对对方很了解或事先询问，我定会选择消耗品或生命周期较短的物品。女生花、零食、化妆品成为首选，男生吃顿饭就算过去了。</p>

<h2 id="toc_1">书</h2>

<p>书是我比较倾向的一类。<br/>
一来身边朋友大多抱着大学文凭，书的品类众多，因此即便对方早已对读书嗤之以鼻，也总能有那么几本适合的。<br/>
二来书籍适合转送。即便很不巧地送错了书，被赠予者也可以无压力地转送出去。如上所说，送礼重要的是心意，心意传达到了，自然皆大欢喜。<br/>
缺点是，除非对方嗜书如命，否则很难从这礼物中感受到惊喜。</p>

<h2 id="toc_2">红包</h2>

<p>关系很铁或很官方时没问题。</p>

<h2 id="toc_3">兴趣对口周边</h2>

<p>简单粗暴但仍需仔细确认。<br/>
如果对方是宅宅，送手办。<br/>
程序员，耳机键盘科技产品。<br/>
运动达人，运动装备。<br/>
程序猿，吃。<br/>
设计师，钱。</p>

<h2 id="toc_4">是否要事先询问</h2>

<p>当我做好打算赠送非消耗品时，一定会认真询问。虽然有时会略显尴尬，又让对方失去了惊喜。但是对于一个信奉简约思想的朋友来说，无疑是极为合适的。重要的是，虽然没了惊喜，却能让人感受到你满满的诚意。</p>

<p>说了这些，回头想想现实其实并没这么复杂。现实中多的是收到什么礼物都感到惊喜的朋友。只是当对方是一个对生活认真且谨慎的人，而他又对你很重要时，切记，要谨慎处理。</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2016/11/30</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8.html'>生活日常</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="14705728845498.html">
                
                  <h1>微博自动发贴，简单却不容易被注意到的反爬方式</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>移动端登录后移步 <a href="http://m.weibo.cn/mblog">http://m.weibo.cn/mblog</a> 页面发贴，正常思路是：填写消息-&gt;其它选项-&gt;点击发送。</p>

<pre><code>tv_msg.send_keys(&quot;msg&quot;)
btn_send.click()
</code></pre>

<p>仔细看下细节，会发现，发送按钮一开始是disable的，输入消息后才会变成enable。<br/>
所以按理说，代码确实没有问题。可是执行结果是最终停留在这个页面，而且send按钮<strong>并没有</strong>变成可用的橙色。</p>

<p>测试最后发现，msg输入后，send并不会立即改变状态，而是有一个很小的延迟时间。而因为机器的执行速度极快，导致在send状态改变前，已经执行了click动作。所以发送动作没有如期进行。</p>

<p>在其中加入一点delay解决问题。</p>

<pre><code>tv_msg.send_keys(&quot;msg&quot;)
time.sleep(0.1)
btn_send.click()
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2016/8/7</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8.html'>生活日常</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="14705395849188.html">
                
                  <h1>利用 Python + Selenium 实现对页面的指定元素截图(可截长图元素)</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h2 id="toc_0">对WebElement截图</h2>

<p>WebDriver.Chrome自带的方法只能对当前窗口截屏，且不能指定特定元素。若是需要截取特定元素或是窗口超过了一屏，就只能另辟蹊径了。<br/>
WebDriver.PhantomJS自带的方法支持对整个网页截屏。<br/>
下面提供几种思路。</p>

<h4 id="toc_1">方式一</h4>

<blockquote>
<p>针对WebDriver.Chrome</p>
</blockquote>

<p>通过WebDriver的js脚本注入功能，曲线救国。<br/>
1. 注入第三方html转canvas的js库(见下方推荐)<br/>
2. 获取元素html源码<br/>
3. 将html转换为canvas<br/>
4. 下载canvas</p>

<p><strong>优点</strong>: 截取长图容易实现<br/>
<strong>缺点</strong>: 加载第三方库耗费时间，转换原理请参考这篇文章:<br/>
<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Drawing_DOM_objects_into_a_canvas">将 DOM 对象绘制到 canvas 中</a></p>

<h4 id="toc_2">方式二</h4>

<blockquote>
<p>针对WebDriver.Chrome</p>
</blockquote>

<p>截取全图，自行裁剪、拼接<br/>
1. 获取元素位置、大小<br/>
2. 获取窗口大小<br/>
3. 截取包含元素的窗口<br/>
4. 进行相应的裁剪和拼接。</p>

<p>具体算法思路很清晰，但需要注意的细节较多。这里就不在赘述。示例代码请移步: <br/>
<a href="https://github.com/auv1107/PythonSpiderLibs">[Github]PythonSpiderLibs</a></p>

<p><strong>优点</strong>: 不需太多js工作，python+少量js代码即可完成<br/>
<strong>缺点</strong>: 拼接等工作会被WebDriver的实现差异、图片加载速度等因素影响，需多加注意。 在保证截图质量的情况下，速度较慢</p>

<h4 id="toc_3">方式三</h4>

<blockquote>
<p>针对WebDriver.PhantomJS<br/>
由于接口实现的差异，PhantomJS相比于Chrome，可以截取到整个网页。所以获取指定元素的截图也就简单很多</p>
</blockquote>

<ol>
<li>截取网页全图</li>
<li>裁剪指定元素</li>
</ol>

<pre><code>driver = webdriver.Chrome()
driver.get(&#39;http://stackoverflow.com/&#39;)
driver.save_screenshot(&#39;screenshot.png&#39;)

left = element.location[&#39;x&#39;]
top = element.location[&#39;y&#39;]
right = element.location[&#39;x&#39;] + element.size[&#39;width&#39;]
bottom = element.location[&#39;y&#39;] + element.size[&#39;height&#39;]

im = Image.open(&#39;screenshot.png&#39;) 
im = im.crop((left, top, right, bottom))
im.save(&#39;screenshot.png&#39;)
</code></pre>

<p><strong>优点</strong>: 实现简单<br/>
<strong>缺点</strong>: 对于高度太高的页面会导致文件过大，处理会有问题，我测试的最大图片尺寸是12.8M。</p>

<h4 id="toc_4">解决图片加载不完整的问题</h4>

<p>参考: <a href="http://codingpy.com/article/take-screenshot-of-web-page-using-selenium/">利用 Python + Selenium 自动化快速截图</a></p>

<p>我们先在首页上执行一段 JavaScript 脚本，将页面的滚动条拖到最下方，然后再拖回顶部，最后才截图。这样可以解决像上面那种按需加载图片的情况。</p>

<pre><code>from selenium import webdriver
import time


def take_screenshot(url, save_fn=&quot;capture.png&quot;):
    browser = webdriver.Firefox() # Get local session of firefox
    browser.set_window_size(1200, 900)
    browser.get(url) # Load page
    browser.execute_script(&quot;&quot;&quot;
        (function () {
            var y = 0;
            var step = 100;
            window.scroll(0, 0);

            function f() {
                if (y &lt; document.body.scrollHeight) {
                    y += step;
                    window.scroll(0, y);
                    setTimeout(f, 100);
                } else {
                    window.scroll(0, 0);
                    document.title += &quot;scroll-done&quot;;
                }
            }

            setTimeout(f, 1000);
        })();
    &quot;&quot;&quot;)

    for i in xrange(30):
        if &quot;scroll-done&quot; in browser.title:
            break
        time.sleep(10)

    browser.save_screenshot(save_fn)
    browser.close()


if __name__ == &quot;__main__&quot;:

    take_screenshot(&quot;http://codingpy.com&quot;)

</code></pre>

<h2 id="toc_5">不同wewbdriver对某些方法的实现不同</h2>

<p>Chrome和PhantomJS 的接口差异<br/>
抓知乎时的坑，<br/>
1. Chrome用<code>WebElement.text</code>可以正常得到值，用PhantomJS只能用 <code>WebElement.get_attribute(&#39;innerHTML&#39;)</code><br/>
2. WebDriver.Chrome截图只能截当前屏幕区域。WebDriver.PhantomJS截图可以获取整个页面的长图。</p>

<p>其它还有一些坑等待发现</p>

<h2 id="toc_6">推荐</h2>

<ol>
<li><a href="http://html2canvas.hertzen.com/documentation.html">html2canvas库</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Drawing_DOM_objects_into_a_canvas">将 DOM 对象绘制到 canvas 中</a></li>
<li><a href="http://codingpy.com/article/take-screenshot-of-web-page-using-selenium/">利用 Python + Selenium 自动化快速截图</a></li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2016/8/7</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8.html'>生活日常</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="14698088043297.html">
                
                  <h1>谈谈爬虫-模拟登录思路</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>最近在做的sideproject，需要网络上的文章数据。于是顺便学习了下爬虫技术，也算是有些心得体会。写下来分享给刚入坑的新人。</p>

<h2 id="toc_0">怎么理解模拟登录？</h2>

<p>怎么理解模拟登录？<br/>
把这句话补全就是： 怎么(让机器)模拟(人在浏览器上的行为)登录(指定的网站)。<br/>
那么这个问题实际上问的是： 人通过浏览器登录网站时，浏览器为我们做了哪些事情。<br/>
那么我们需要做的只有：写一个脚本，让这个脚本模拟浏览器的行为，做我们希望它做的事情。</p>

<p>有兴趣参考:<br/>
 <a href="https://www.zhihu.com/question/34873227">当在浏览器地址栏输入一个URL后回车，将会发生的事情？</a></p>

<p><strong>那么</strong>，<br/>
人类在登录时做了哪些事情呢，很简单：<br/>
1. 打开登录页面<br/>
2. 输入用户名密码，有时可能还有验证码，各种各样的验证码<br/>
3. 点击登录<br/>
4. 等待浏览器自动跳转</p>

<p>只要你稍微懂一点html语言，就应该能分析个八九不离十。<br/>
机器人怎么做呢：<br/>
两种方式：</p>

<p><strong>方式一</strong>：<br/>
需要使用虚拟的浏览器引擎。<br/>
优点: 适合几乎所有的网站登录，可以人为输入验证码<br/>
缺点: 速度较慢<br/>
1. 请求登录页面的url，比如微博的(<a href="https://passport.weibo.cn/signin/login">https://passport.weibo.cn/signin/login</a>)<br/>
2. 分析html中的表单数据<br/>
2.1 找到输入用户名、密码的输入框<br/>
2.2 把输入框的text域替换成自己的用户名密码<br/>
3. 模拟点击提交按钮</p>

<p><strong>方式二</strong>：<br/>
分析登录信息提交方式，一般就是表单<br/>
优点: 轻量，速度快<br/>
缺点: 局限性大，对技术要求高，对验证码机制需要做针对的破解<br/>
1. 使用浏览器的调试模式查看网页<br/>
2. 检查是否使用表单提交<br/>
3. 点击登录按钮，查看发送的请求数据。主要查看参数有无加密验证或其它隐藏信息。<br/>
4. 使用分析结果进行请求操作</p>

<p>对于一般用户，所有的非特殊性需求都可以使用方式一进行完成。<br/>
若非是为了学习，推荐方式一。</p>

<p>技术资料请参考:<br/>
<a href="http://cuiqingcai.com/1052.html">Python爬虫学习系列教程</a>(推荐)<br/>
<a href="http://www.voidcn.com/blog/eastmount/article/p-5954929.html">[Python爬虫] Selenium爬取新浪微博移动端热点话题及评论 (下)</a></p>

<h2 id="toc_1">如何让脚本的行为看起来像人？</h2>

<p><strong>为什么要像人</strong><br/>
因为很多服务器会使用一些反爬技术拒绝爬虫软件访问。</p>

<p><strong>哪些东西让你看起来像人，哪些不像人</strong><br/>
像人，其实可以分为两点。<br/>
一类是看请求数据，是否符合是浏览器发出的正常数据，比如header内容。<br/>
一类是看行为模式，发送请求对象的行为更像人类还是机器人，比如请求的频率。</p>

<p>不像人，和上面对应。<br/>
从请求数据上看，你没说明user-agent,我就可以认为你是非法侵入。你没有带着我之前给你的饼干(cookie)来，我也可以拒绝你。<br/>
从行为模式上，同一个ip访问的频率过高，短时间内流量异常，都可以作为非人类处理。</p>

<h2 id="toc_2">结合反爬技术</h2>

<ol>
<li>需要登录用cookie</li>
<li>ip限制加代理</li>
<li>用user-agent告诉对方你是浏览器</li>
<li>服务器限制访问频率，加延迟</li>
<li>ajax异步加载，使用js引擎或者人工分析</li>
<li>redirect，最简单的方式虚拟内核＋延迟</li>
<li>验证码，虚拟内核</li>
</ol>

<h2 id="toc_3">如何找切入点？</h2>

<p>什么是好的登录页面？<br/>
没有验证码，非ajax异步加载。<br/>
不一定局限于pc端网页，app端、移动端一般做的反爬策略比较少，可以从这里入手，寻找适合的站点。</p>

<p>理解自己要做什么，如何伪装成人类。仔细思考访问流程，针对性的有哪些反爬手段。把这些想通了，爬虫之路会好走很多。</p>

<p>转载请注明：<a href="http://lixindong.top">未命名的博客</a></p>

<h2 id="toc_4">相关文章和资料</h2>

<p>技术语言资料请自行google。</p>

<ol>
<li><a href="https://www.zhihu.com/question/28168585">如何应对网站反爬虫策略？如何高效地爬大量数据?</a></li>
<li><a href="https://www.zhihu.com/question/27621722">能利用爬虫技术做到哪些很酷很有趣很有用的事情?</a>(很有意思)</li>
<li><a href="http://cuiqingcai.com/1052.html">Python爬虫学习系列教程</a>(推荐)</li>
<li><a href="http://www.voidcn.com/blog/eastmount/article/p-5954929.html">[Python爬虫] Selenium爬取新浪微博移动端热点话题及评论 (下)</a></li>
</ol>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2016/7/30</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8.html'>生活日常</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="14691078063823.html">
                
                  <h1>使用Github的Webhooks进行网站的自动化部署</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>使用mWeb做自己的博客，服务器没有直接使用github的gh-pages功能，而是部署到了自己的服务器上。<br/>
从此更新博客变成了三步走：1. 使用mWeb生成静态网页 2. push 到github 3. 登录服务器拉取最新内容。</p>

<p>昨天想到，能不能再简化一些步骤，让我的文章push到github后，让服务器自动拉取文章，部署新内容。说干就干，实施想法。</p>

<h2 id="toc_0">1. 目标</h2>

<p>服务器自动拉取push到github上的新文章。</p>

<h2 id="toc_1">2. 想法</h2>

<p>想法一: 定时检查置顶repo的提交，有更新，则启动部署流程。（主动查询方式）<br/>
想法二: github是否支持事件提醒或者第三方有无支持。(被动唤醒方式)(相当于消息推送)</p>

<h2 id="toc_2">3. 思考</h2>

<p>主动查询，耗费cpu时间及流量，并且必然会和github产生同步间隔。<br/>
被动唤醒，不会消耗不必要的资源，若是支持必然是第一选项。</p>

<h2 id="toc_3">4. 查阅资料(可行性分析)</h2>

<p>github支持Webhooks及大量的第三方服务，可以很好得对repo的push等操作做出反应。</p>

<p><strong>Webhooks做了什么?</strong><br/>
当github收到repo的操作行为时，会向指定的url发送一个带有描述操作内容的post请求。</p>

<h2 id="toc_4">5. 实现思路(总结)</h2>

<p>对指定repo注册webhooks，指向我的服务器上的接口，服务器解析数据，若操作是push，则进行部署行为。</p>

<h2 id="toc_5">6. 实现</h2>

<h4 id="toc_6">6.1 部署脚本：</h4>

<p><strong>deploy.sh</strong></p>

<pre><code>#!/bin/bash

LOG_FILE=&quot;/var/log/blog_deploy.log&quot;

date &gt;&gt; &quot;$LOG_FILE&quot;
echo &quot;Start deployment&quot; &gt;&gt;&quot;$LOG_FILE&quot;
cd /Path/need/be/deployed/
echo &quot;pulling source code...&quot; &gt;&gt; &quot;$LOG_FILE&quot;
git checkout origin gh-pages
git pull origin gh-pages
echo &quot;Finished.&quot; &gt;&gt;&quot;$LOG_FILE&quot;
echo &gt;&gt; $LOG_FILE
</code></pre>

<p>每当接收到带push的post请求时，执行上面的脚本。</p>

<h4 id="toc_7">6.2 处理post请求</h4>

<p>注：以下nodejs内容摘自<a href="http://www.lovelucy.info/auto-deploy-website-by-webhooks-of-github-and-gitlab.html">曾曦前辈博客－尘埃落定</a></p>

<blockquote>
<p>然后我们就要写一个脚本在 <a href="http://dev.lovelucy.info/incoming">http://dev.lovelucy.info/incoming</a> 这里接受 POST 请求了。因为本人机器上跑的是 node，俺就找了个 nodejs 的中间件 github-webhook-handler 。如果你要部署的是 PHP 网站，那你应该找一个世界上最好的语言 PHP 的版本，或者自己写一个，只需要接收 $_POST 嘛，好简单的，不多废话啦。么么哒 ( • ̀ω•́ )</p>
</blockquote>

<pre><code>$ npm install -g github-webhook-handler
</code></pre>

<blockquote>
<p>鉴于在天朝的服务器上 npm 拉 repo 比拉屎还难的状况，我们可以 选用 阿里的镜像，据说 10 分钟和官方同步一次。_(:3 」∠ )_</p>
</blockquote>

<pre><code>$ npm install -g cnpm --registry=http://r.cnpmjs.org
$ cnpm install -g github-webhook-handler
</code></pre>

<blockquote>
<p>好了，万事俱备，下面是 NodeJS 的监听程序 deploy.js</p>
</blockquote>

<pre><code>var http = require(&#39;http&#39;)
var createHandler = require(&#39;github-webhook-handler&#39;)
var handler = createHandler({ path: &#39;/incoming&#39;, secret: &#39;myHashSecret&#39; }) 
// 上面的 secret 保持和 GitHub 后台设置的一致
 
function run_cmd(cmd, args, callback) {
  var spawn = require(&#39;child_process&#39;).spawn;
  var child = spawn(cmd, args);
  var resp = &quot;&quot;;
 
  child.stdout.on(&#39;data&#39;, function(buffer) { resp += buffer.toString(); });
  child.stdout.on(&#39;end&#39;, function() { callback (resp) });
}
 
http.createServer(function (req, res) {
  handler(req, res, function (err) {
    res.statusCode = 404
    res.end(&#39;no such location&#39;)
  })
}).listen(7777)
 
handler.on(&#39;error&#39;, function (err) {
  console.error(&#39;Error:&#39;, err.message)
})
 
handler.on(&#39;push&#39;, function (event) {
  console.log(&#39;Received a push event for %s to %s&#39;,
    event.payload.repository.name,
    event.payload.ref);
  run_cmd(&#39;sh&#39;, [&#39;./deploy.sh&#39;], function(text){ console.log(text) });
})
 
/*
handler.on(&#39;issues&#39;, function (event) {
  console.log(&#39;Received an issue event for % action=%s: #%d %s&#39;,
    event.payload.repository.name,
    event.payload.action,
    event.payload.issue.number,
    event.payload.issue.title)
})
*/
</code></pre>

<p>之后把服务器跑起来就可以了。</p>

<pre><code>$ nodejs deploy.js
</code></pre>

<p>为了防止服务挂掉，我们有很多方式可以处理。我选择了用系统自带的nohup。</p>

<pre><code>$ nohup nodejs deply.js &amp;
</code></pre>

<p>曾曦前辈使用的是 NodeJs的forever，也可以使用python的supervisor。<br/>
<a href="http://www.lovelucy.info/auto-deploy-website-by-webhooks-of-github-and-gitlab.html">曾曦前辈博客－尘埃落定</a>有相关介绍。</p>

<h4 id="toc_8">6.3 配置Webhooks监听</h4>

<p>将Payload URL指向自己服务器的接口<br/>
<img src="media/14691078063823/14691103881759.jpg" alt=""/></p>

<pre><code>var handler = createHandler({ path: &#39;/incoming&#39;, secret: &#39;myHashSecret&#39; })

http.createServer(function (req, res) {
  handler(req, res, function (err) {
    res.statusCode = 404
    res.end(&#39;no such location&#39;)
  })
}).listen(7777)
</code></pre>

<p>这是deploy.js 的关键代码。<br/>
listen(7777)，表明服务器监听的是7777端口<br/>
path:&#39;/incoming&#39;，表示在 ip:7777/incoming 接收POST请求<br/>
secret: &#39;myHashSecret&#39;, 要求和上图的Secret字段一样，不然服务器会因为不匹配，拒绝接收到的请求。主要为了防止第三方向这个端口发送请求。</p>

<h2 id="toc_9">7. 最后梳理一下</h2>

<p><strong>6.3 那里知道什么时候有人提交文章了，然后告诉6.2 有人push</strong><br/>
<strong>6.2 从6.3 得到消息，看下你的密码(secret)和我的一样不，如果一样，我就把这个消息告诉6.1</strong><br/>
<strong>6.1 开始跑到github数据库拉取最新的数据，部署完成</strong></p>

<h2 id="toc_10">澄清</h2>

<p>有朋友告诉我，复制粘贴的部分比较多。即便加了转载说明，也不是很好。<br/>
在这里澄清一下：<br/>
网络上技术文章特点：<strong>多</strong>，<strong>杂</strong>，<strong>全</strong><br/>
可用的经典实例: <strong>少</strong><br/>
自生产实例的成本: <strong>费时</strong><br/>
一篇<strong>全原创</strong>的优质文章需要：<strong>思考</strong>＋<strong>原创实例</strong>＋<strong>码字</strong>＋<strong>重复前三项</strong> 。<br/>
而对于学习者而言，<strong>思想＋实例＋思路</strong>已经满足80%。<br/>
所以我认为，一篇能学到东西的技术文章，并不需要<strong>全原创</strong>。<br/>
清晰的思路＋前人提供的经典实例＋个人思考，传达到位即可。</p>

<p><strong>前人都总结好了，你再发一遍，不是制造网络垃圾吗？</strong><br/>
打造一个以思路清晰著称的博客，专注于技术文章整理、重成文是本博客存在的意义。我不是垃圾的生产者，我是大自然的清道夫。</p>

<p>欢迎关注个人微博<a href="http://weibo.com/u/6300854978">斯科特安的时间 </a>，进行技术、非技术交流。</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2016/7/21</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8.html'>生活日常</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="14686843615662.html">
                
                  <h1>10分钟快速搭建无限制流量的"VPN"（shadowsocks协议）</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>Too Long No Read： 阅读标题和标重点部分就能了解全部内容。</p>

<h2 id="toc_0">1. 简介</h2>

<p>良心声明: 有朋友说10分钟根本连文章都看不完，哪能建起个自己完全不熟悉的V P N 呢？<br/>
所以在这里必须解释一波：10分钟指的是开始动手到可以使用的时间。并不包括读这篇文章的时间，也不包括你在搭建服务过程中自我纠结的时间（比如，租多大的服务器？用什么密码？剁完手后又要饿多久的肚子才能给女票买下件内衣？之类。别问我为什么知道你一定是男的）最后，不包括运行出错，调试测试的时间。因为，按我说的做，你根本不可能失败！</p>

<p>接下来是简介：<br/>
说是无限制流量，其实骗你的啦（可爱）。说是VPN，其实不限于VPN。（本文搭建的也不是VPN，而是被称为Shadowsocks的协议。）<br/>
接下来解释：<br/>
<strong>原理:</strong> 租一个国外的服务器 --&gt;这个服务器上搭建自己的VPN --&gt; 通过这个VPN科学上网。<br/>
<strong>无限制流量：</strong>500G，1T，甚至更多。一月这么多，用的完吗？用不完不就相当于无限制。<br/>
<strong>VPN：</strong>既然有了自己墙外的服务器，就可以用它搭建任何自己想要的科学上网利器。本文章主要介绍当下最安全、最流行的<strong>ShadowSocks</strong>.<br/>
<strong>价格：</strong>很便宜！！很便宜！！很便宜！！</p>

<h2 id="toc_1">2. 工具篇</h2>

<h3 id="toc_2">2.1 VPS 国外的服务器</h3>

<p><strong>VPS：</strong>Virtual Private Server 虚拟专用服务器<br/>
其实你就知道是个自己能用来搭建科学上网服务的主机就行了。<br/>
一般不了解的人，第一反应都是：卧槽，我指用个10G流量只能翻墙的VPN就几十块一个月。那租一个可以干很多事情、不限流量的服务器，岂不要几百几千？其实不用998、不用98，绝对用你想不到的价格，买到最不可思议的产品！</p>

<p><strong>2020年限时特惠！
	虚拟服务器注册即得100美元奖励金！</strong><br/>
<a href="https://www.vultr.com/?ref=8557194-6G">点击注册得100美金</a><br/>
仅此一个月！</p>

<p><strong>推荐：</strong></p>

<h4 id="toc_3">1. 搬瓦工 (稳定推荐)</h4>

<p><strong>优点：</strong>便宜！！最低500G流量，年购19.99美刀，使用优惠码还可以再减1刀左右。相当于每月10元。这价格已经比大多数VPN便宜了。<br/>
<strong>支持支付宝交易！</strong><br/>
<strong>支持30天内退款</strong> 一般一个工作日内就能回复，支付宝收到2～3天。<br/>
<strong>一键配置shadowsocks！</strong>如果使用搬瓦工，那后面的内容都不用看了，点下面的链接注册即可。<br/>
官方网址：<a href="http://r.antiless.com/bwg">https://bandwagonhost.com/</a><br/>
如果被墙也可使用: <a href="http://r.antiless.com/bwg">https://bwh8.net</a><br/>
两个都是官方地址</p>

<p>数据中心：美国西雅图、佛罗里达、洛杉矶、荷兰 套餐价格：64MB内存年3.99美元 / 96MB内存年4.99美元/128MB内存年5.99美元/512MB内存年9.99美元 简单介绍：IT7官方旗下的低价VPS主机产品，拥有速度较好的西岸亚利桑那州机房，最低年付仅需3.99美元，我们可以用来学习、工作项目演示，以及需要支持PPP/TUN搭建工具使用需求。拥有4个数据中心，而且可以自由切换IP，更换不同的IP，解决IP被封问题。</p>

<p>最新资料 <strong>可登录搬瓦工中文资料站进行查看</strong><br/>
<a href="https://bwg8.info">搬瓦工中文</a></p>

<h4 id="toc_4">2. Vultr （低价推荐，我自己目前在用）</h4>

<p><strong>2020年限时特惠！注册即得100美元奖励金！</strong><br/>
<a href="https://www.vultr.com/?ref=8557194-6G">点击注册得100美金</a><br/>
仅此一个月！</p>

<hr/>

<p><a href="https://www.vultr.com/?ref=8557194-6G">注册网址</a><br/>
<strong>优点</strong> <br/>
1. 注册赠100美金。使用最低标准服务5刀/月，相当于可以免费使用4个月。(活动已经失效，但最低标准服务价格<strong>下调到2.5刀/月</strong>，可以说是相当实惠了！)<br/>
2. 服务稳定。至少我还没碰到过当机情况。<br/>
3. <del>第三点是缺点，想获得100美金，必须使用信用卡支付，并且扣除2.5美元的验证费。（以后会返还）</del><br/>
4. 现在已全面支持<strong>支付宝/微信付款</strong>，非常方便，也不需要绑定信用卡了。<br/>
<a href="https://www.vultr.com/?ref=8557194-6G">点击注册并获取100美金</a></p>

<p>数据中心：日本、洛杉矶、英国、法国、德国、荷兰、澳大利亚等14个机房<br/>
套餐价格：KVM 768MB 15GB SSD 1TB月流量 <strong>$5/月</strong><br/>
简单介绍：Vultr作为全球最大的游戏主机提供商背景之一，上线之后以高质的性价比、12个数据中心，以及新注册账户赠送5美金的账户使用金优惠促销，吸引广大的用户。作为我们用户，日本、洛杉矶等数据中心速度较好，如果有需要海外其他机房也可以在其12个数据中心中选择到适合自己的。</p>

<p>官方网站：<a href="https://www.vultr.com/?ref=8557194-6G">https://www.vultr.com</a></p>

<h4 id="toc_5">3. 其它</h4>

<p>因为我指用过上面两个，所以其他的也不多介绍了。列个列表，大家可以自行google。<br/>
Linode: 很多人推荐。速度快。价格中等。<br/>
DigitalOcean: 很多人推荐。速度快，价格差不多。</p>

<h4 id="toc_6">为什么说价格便宜</h4>

<p>除了明码标价的价格。其实本身已经和普通VPN价格差不多了。但是仍然，有一点。虽然流量并不是无限，但是带宽并没有限制。就是说，在流量还够用的前提下，和朋友一起使用，是几乎不影响访问速度的，价格又能再除以...,最后折算下来非常可观。当然，不能超越物理极限，3、5个人一起用，是保险又便利的方式。</p>

<h4 id="toc_7">价格上，贵就是好</h4>

<p>对于同类物品，贵就是好。所以无论是我提到的，还是没提到的，虽然价格有差异，但是毕竟体现在服务好坏上。所以，如果你发现不同价格，买到了同样的配置，但是实际效果却有差距，这很正常。</p>

<h3 id="toc_8">2.2 Python Shadowsocks 搭建服务的工具和协议</h3>

<p>Shadowsocks 属于socks5 代理，稳定性好，抗干扰能力强。</p>

<h4 id="toc_9">搭建服务 三步走</h4>

<p>1 . 安装<br/>
 在CentOS中运行下面两条命令就完成了shadowsocks的安装了：</p>

<pre><code>yum install python-setuptools &amp;&amp; easy_install pip
pip install shadowsocks
</code></pre>

<p>2 . 配置<br/>
完成之后创建一个配置文件 /etc/shadowsocks.json，写入以下内容：</p>

<pre><code>{ 
        &quot;server&quot;:&quot;0.0.0.0&quot;,            #服务器IP地址
        &quot;server_port&quot;:8388,                 #服务监听端口
        &quot;local_port&quot;:1080,                  #本地连接端口
        &quot;password&quot;:&quot;barfoo&quot;,               #加密传输使用到的密码
        &quot;timeout&quot;:600,                      #连接超时时间
        &quot;method&quot;:&quot;aes-256-cfb&quot;             #加密算法
}
</code></pre>

<p>3 . 启动、停止<br/>
运行下面的命令来启动和停止后台服务：</p>

<pre><code>ssserver -c /etc/shadowsocks.json -d start
ssserver -c /etc/shadowsocks.json -d stop
</code></pre>

<h4 id="toc_10">然后你就可以使用上面的配置连接shadowsocks了。</h4>

<ol>
<li>客户端如何用？</li>
</ol>

<p>各个平台使用的客户端都有差异，但是用到的信息就这些：<br/>
－ 服务器IP: 不是上面的0.0.0.0，是你申请的VPS，会提供一个ip。打开网站，登录，找到它<br/>
－ 端口(port): 8388<br/>
－ 协议类型: aes-256-cfb 一般默认就这个，不用换。但还是要看一眼。<br/>
－ 密码(password): barfoo<br/>
连接，欢呼。</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2016/7/16</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8.html'>生活日常</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <h1>博客未命名</h1>
                <div class="site-des">专注于重成文思路清晰的技术文章。</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="http://github.com/auv1107" title="GitHub">GitHub</a>

  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="%E7%94%9F%E6%B4%BB%E6%97%A5%E5%B8%B8.html"><strong>生活日常</strong></a>
        
            <a href="%E7%BB%98%E7%94%BB.html"><strong>绘画</strong></a>
        
            <a href="Android%E5%BC%80%E5%8F%91.html"><strong>Android开发</strong></a>
        
            <a href="%E4%BA%A7%E5%93%81%E6%83%B3%E6%B3%95.html"><strong>产品想法</strong></a>
        
            <a href="%E5%90%89%E5%AE%83%E5%AD%A6%E4%B9%A0%F0%9F%8E%B8.html"><strong>吉它学习🎸</strong></a>
        
            <a href="web%E5%BC%80%E5%8F%91.html"><strong>web开发</strong></a>
        
            <a href="%E4%B9%A6%E7%B1%8D%E7%94%B5%E5%BD%B1.html"><strong>书籍电影</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="14896760685794.html">每天早上的小剧场</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14875026448350.html">金克丝动态线稿</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14875024153456.html">真人改漫画</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14870798001565.html"></a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="14864295694789.html">第二张默画</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?84fca9a2f5023159ce7f5a699c8bf2d0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  </body>
</html>
